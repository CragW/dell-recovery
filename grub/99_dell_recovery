#!/bin/bash -e

source /usr/lib/grub/grub-mkconfig_lib

cat << EOF
menuentry "#RECOVERY_TEXT#" {
        set root='(hd0,#PARTITION#)'
        search --no-floppy --fs-uuid --set #UUID#
        if [ -s /boot/grub/common.cfg ]; then
            source /boot/grub/common.cfg
        else
            set options="boot=casper automatic-ubiquity noprompt quiet splash"
        fi
        #Support starting from a loopback mount (Only support ubuntu.iso for filename)
        if [ -f /ubuntu.iso ]; then
            loopback loop /ubuntu.iso
            set root=(loop)
            set options="\$options iso-scan/filename=/ubuntu.iso"
        fi
        if [ -n "\${lang}" ]; then
            set options="\$options locale=\$lang"
        fi

        linux   /casper/vmlinuz dell-recovery/recovery_type=hdd \$options #EXTRA#
	initrd	/casper/initrd.lz
}
EOF

